#!/usr/bin/env sh

# Branch Cleanup Script
# Usage:
#   Run without arguments to delete local branches that have been merged into master,
#   excluding the current branch and master itself, and prunes deleted branches from the remote.
#     Example: ./script.sh

show_usage() {
    echo "Usage: $0 [-h]"
    echo "Delete local branches that have been merged into main, excluding the current branch and main itself."
    echo "Also prunes deleted branches from the remote."
    echo ""
    echo "Options:"
    echo "  -h    Show this help message"
    exit 1
}

# Handle -h flag
if [ "$1" = "-h" ]; then
    show_usage
fi

git branch --merged main | grep -v -e 'main' -e '\*' | xargs -n 1 git branch -d && git remote prune origin
